{
  "version": 3,
  "sources": ["../../../../functions/listMessages/index.mjs"],
  "sourcesContent": ["import {\n  ScanCommand as ScanCmd,\n  QueryCommand as QueryCmd,\n} from \"@aws-sdk/client-dynamodb\";\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\n\nconst client = new DynamoDBClient({ region: \"eu-north-1\" });\n\nconst sendResponse = (statusCode, body) => ({\n  statusCode,\n  headers: {\n    \"Content-Type\": \"application/json\",\n    \"Access-Control-Allow-Origin\":\n      \"http://shui-board-frontend.s3-website.eu-north-1.amazonaws.com\",\n    \"Access-Control-Allow-Credentials\": true,\n  },\n  body: JSON.stringify(body),\n});\n\nconst formatItem = (item) => ({\n  id: item.messageId.S,\n  username: item.username.S,\n  text: item.text.S,\n  createdAt: item.createdAt.S,\n});\n\n// Funci\u00F3n principal\nexport const handler = async (event) => {\n  try {\n    // \uD83D\uDD0A Imagina que estamos abriendo el carrito para ver qu\u00E9 query llega\n    const queryParams = event.queryStringParameters || {};\n    console.log(\"Query parameters recibidos:\", queryParams);\n\n    const username = queryParams.username?.trim(); // eliminar espacios en blanco\n    const sort = queryParams.sort === \"asc\" ? \"asc\" : \"desc\";\n\n    // Si hay username v\u00E1lido, usar \u00EDndice secundario\n    console.log(\"Username recibido:\", username);\n    if (username) {\n      // \uD83C\uDFF7\uFE0F \"Etiqueta del estante\": username\n      const params = {\n        TableName: process.env.TABLE_NAME || \"ShuiMessages\",\n        IndexName: \"userIndex\",\n        KeyConditionExpression: \"username = :u\",\n        ExpressionAttributeValues: { \":u\": { S: username } },\n        ScanIndexForward: sort === \"asc\", // true = ascendente\n      };\n\n      console.log(\"Query DynamoDB con \u00EDndice userIndex:\", params);\n\n      const result = await client.send(new QueryCmd(params));\n      const items = (result.Items || []).map(formatItem);\n\n      // \uD83C\uDFA8 Asociaci\u00F3n visual: ordenar los mensajes como si fueran post-its en el tablero\n      return sendResponse(200, items);\n    } else {\n      // Si no hay username, hacemos un scan general\n      console.log(\"No se envi\u00F3 username v\u00E1lido \u2192 haciendo scan completo\");\n\n      const result = await client.send(\n        new ScanCmd({ TableName: process.env.TABLE_NAME || \"ShuiMessages\" })\n      );\n\n      let items = (result.Items || []).map(formatItem);\n\n      // Orden descendente por defecto\n      items.sort((a, b) => b.createdAt.localeCompare(a.createdAt));\n      if (sort === \"asc\") items.reverse();\n\n      return sendResponse(200, items);\n    }\n  } catch (error) {\n    console.error(\"listMessages error:\", error);\n    // \uD83D\uDD0A Nemotecnia auditiva: DynamoDB grita \u201C500 Internal Error\u201D si no puede procesar tu carrito\n    return sendResponse(500, { error: \"Internal error\" });\n  }\n};\n"],
  "mappings": "AAAA,OACE,eAAeA,EACf,gBAAgBC,MACX,2BACP,OAAS,kBAAAC,MAAsB,2BAE/B,IAAMC,EAAS,IAAID,EAAe,CAAE,OAAQ,YAAa,CAAC,EAEpDE,EAAe,CAACC,EAAYC,KAAU,CAC1C,WAAAD,EACA,QAAS,CACP,eAAgB,mBAChB,8BACE,iEACF,mCAAoC,EACtC,EACA,KAAM,KAAK,UAAUC,CAAI,CAC3B,GAEMC,EAAcC,IAAU,CAC5B,GAAIA,EAAK,UAAU,EACnB,SAAUA,EAAK,SAAS,EACxB,KAAMA,EAAK,KAAK,EAChB,UAAWA,EAAK,UAAU,CAC5B,GAGaC,EAAU,MAAOC,GAAU,CACtC,GAAI,CAEF,IAAMC,EAAcD,EAAM,uBAAyB,CAAC,EACpD,QAAQ,IAAI,8BAA+BC,CAAW,EAEtD,IAAMC,EAAWD,EAAY,UAAU,KAAK,EACtCE,EAAOF,EAAY,OAAS,MAAQ,MAAQ,OAIlD,GADA,QAAQ,IAAI,qBAAsBC,CAAQ,EACtCA,EAAU,CAEZ,IAAME,EAAS,CACb,UAAW,QAAQ,IAAI,YAAc,eACrC,UAAW,YACX,uBAAwB,gBACxB,0BAA2B,CAAE,KAAM,CAAE,EAAGF,CAAS,CAAE,EACnD,iBAAkBC,IAAS,KAC7B,EAEA,QAAQ,IAAI,0CAAwCC,CAAM,EAG1D,IAAMC,IADS,MAAMZ,EAAO,KAAK,IAAIF,EAASa,CAAM,CAAC,GAC/B,OAAS,CAAC,GAAG,IAAIP,CAAU,EAGjD,OAAOH,EAAa,IAAKW,CAAK,CAChC,KAAO,CAEL,QAAQ,IAAI,iEAAsD,EAMlE,IAAIA,IAJW,MAAMZ,EAAO,KAC1B,IAAIH,EAAQ,CAAE,UAAW,QAAQ,IAAI,YAAc,cAAe,CAAC,CACrE,GAEoB,OAAS,CAAC,GAAG,IAAIO,CAAU,EAG/C,OAAAQ,EAAM,KAAK,CAACC,EAAGC,IAAMA,EAAE,UAAU,cAAcD,EAAE,SAAS,CAAC,EACvDH,IAAS,OAAOE,EAAM,QAAQ,EAE3BX,EAAa,IAAKW,CAAK,CAChC,CACF,OAASG,EAAO,CACd,eAAQ,MAAM,sBAAuBA,CAAK,EAEnCd,EAAa,IAAK,CAAE,MAAO,gBAAiB,CAAC,CACtD,CACF",
  "names": ["ScanCmd", "QueryCmd", "DynamoDBClient", "client", "sendResponse", "statusCode", "body", "formatItem", "item", "handler", "event", "queryParams", "username", "sort", "params", "items", "a", "b", "error"]
}
