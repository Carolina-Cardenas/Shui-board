import{ScanCommand as d,QueryCommand as u}from"@aws-sdk/client-dynamodb";import{DynamoDBClient as p}from"@aws-sdk/client-dynamodb";var m=new p({region:"eu-north-1"}),a=(e,s)=>({statusCode:e,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"http://shui-board-frontend.s3-website.eu-north-1.amazonaws.com","Access-Control-Allow-Credentials":!0},body:JSON.stringify(s)}),i=e=>({id:e.messageId.S,username:e.username.S,text:e.text.S,createdAt:e.createdAt.S}),g=async e=>{try{let s=e.queryStringParameters||{};console.log("Query parameters recibidos:",s);let o=s.username?.trim(),c=s.sort==="asc"?"asc":"desc";if(console.log("Username recibido:",o),o){let n={TableName:process.env.TABLE_NAME||"ShuiMessages",IndexName:"userIndex",KeyConditionExpression:"username = :u",ExpressionAttributeValues:{":u":{S:o}},ScanIndexForward:c==="asc"};console.log("Query DynamoDB con \xEDndice userIndex:",n);let t=((await m.send(new u(n))).Items||[]).map(i);return a(200,t)}else{console.log("No se envi\xF3 username v\xE1lido \u2192 haciendo scan completo");let r=((await m.send(new d({TableName:process.env.TABLE_NAME||"ShuiMessages"}))).Items||[]).map(i);return r.sort((t,l)=>l.createdAt.localeCompare(t.createdAt)),c==="asc"&&r.reverse(),a(200,r)}}catch(s){return console.error("listMessages error:",s),a(500,{error:"Internal error"})}};export{g as handler};
//# sourceMappingURL=index.js.map
