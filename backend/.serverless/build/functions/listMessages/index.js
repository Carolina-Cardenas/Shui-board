import{ScanCommand as d,QueryCommand as u}from"@aws-sdk/client-dynamodb";import{DynamoDBClient as p}from"@aws-sdk/client-dynamodb";var l=new p({region:"eu-north-1"}),a=(e,s)=>({statusCode:e,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:JSON.stringify(s)}),m=e=>({id:e.messageId.S,username:e.username.S,text:e.text.S,createdAt:e.createdAt.S}),g=async e=>{try{let s=e.queryStringParameters||{};console.log("Query parameters recibidos:",s);let n=s.username?.trim(),c=s.sort==="asc"?"asc":"desc";if(console.log("Username recibido:",n),n){let o={TableName:process.env.TABLE_NAME||"ShuiMessages",IndexName:"userIndex",KeyConditionExpression:"username = :u",ExpressionAttributeValues:{":u":{S:n}},ScanIndexForward:c==="asc"};console.log("Query DynamoDB con \xEDndice userIndex:",o);let t=((await l.send(new u(o))).Items||[]).map(m);return a(200,t)}else{console.log("No se envi\xF3 username v\xE1lido \u2192 haciendo scan completo");let r=((await l.send(new d({TableName:process.env.TABLE_NAME||"ShuiMessages"}))).Items||[]).map(m);return r.sort((t,i)=>i.createdAt.localeCompare(t.createdAt)),c==="asc"&&r.reverse(),a(200,r)}}catch(s){return console.error("listMessages error:",s),a(500,{error:"Internal error"})}};export{g as handler};
//# sourceMappingURL=index.js.map
