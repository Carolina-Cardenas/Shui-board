import{ScanCommand as d,QueryCommand as p}from"@aws-sdk/client-dynamodb";import{DynamoDBClient as u}from"@aws-sdk/client-dynamodb";var o=new u({region:"eu-north-1"});var t=(e,r)=>({statusCode:e,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:JSON.stringify(r)});var i=e=>({id:e.id.S,username:e.username.S,text:e.text.S,createdAt:e.createdAt.S}),f=async e=>{try{let r=e.queryStringParameters||{},a=r.username,c=r.sort||"desc";if(a){let m={TableName:process.env.TABLE_NAME||"ShuiMessages",IndexName:"ByUserIndex",KeyConditionExpression:"username = :u",ExpressionAttributeValues:{":u":{S:a}},ScanIndexForward:c==="asc"},n=((await o.send(new p(m))).Items||[]).map(i);return t(200,n)}else{let s=((await o.send(new d({TableName:process.env.TABLE_NAME||"ShuiMessages"}))).Items||[]).map(i);return s.sort((n,l)=>l.createdAt.localeCompare(n.createdAt)),c==="asc"&&s.reverse(),t(200,s)}}catch(r){return console.error("listMessages error",r),t(500,{error:"Internal error"})}};export{f as handler};
//# sourceMappingURL=index.js.map
