import{PutItemCommand as A}from"@aws-sdk/client-dynamodb";import{DynamoDBClient as d}from"@aws-sdk/client-dynamodb";var c=new d({region:"eu-north-1"});var l=(e,t)=>({statusCode:e,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:JSON.stringify(t)});import{webcrypto as p}from"node:crypto";var m="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var h=128,o,n;function g(e){!o||o.length<e?(o=Buffer.allocUnsafe(e*h),p.getRandomValues(o),n=0):n+e>o.length&&(p.getRandomValues(o),n=0),n+=e}function u(e=21){g(e|=0);let t="";for(let r=n-e;r<n;r++)t+=m[o[r]&63];return t}var L=async e=>{try{let t=JSON.parse(e.body||"{}"),{username:r,text:s}=t;if(!r||!s)return l(400,{error:"username and text required"});let a=u(),i=new Date().toISOString(),f={messageId:{S:a},username:{S:r},text:{S:s},createdAt:{S:i}};return await c.send(new A({TableName:process.env.TABLE_NAME||"ShuiMessages",Item:f})),l(201,{id:a,username:r,text:s,createdAt:i})}catch(t){return console.error("createMessage error",t),l(500,{error:"Internal error"})}};export{L as handler};
//# sourceMappingURL=index.js.map
