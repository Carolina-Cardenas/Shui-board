import{PutItemCommand as y}from"@aws-sdk/client-dynamodb";import{DynamoDBClient as f}from"@aws-sdk/client-dynamodb";var c=new f({region:"eu-north-1"});import{webcrypto as m}from"node:crypto";var u="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var h=128,o,n;function g(e){!o||o.length<e?(o=Buffer.allocUnsafe(e*h),m.getRandomValues(o),n=0):n+e>o.length&&(m.getRandomValues(o),n=0),n+=e}function p(e=21){g(e|=0);let t="";for(let r=n-e;r<n;r++)t+=u[o[r]&63];return t}var N=async e=>{try{if(!e.body)return console.error("No hay body en la petici\xF3n"),{statusCode:400,body:JSON.stringify({error:"Request body missing"})};let t=JSON.parse(e.body),{username:r,text:s}=t;if(!r||!s)return l(400,{error:"username and text required"});let a=p(),i=new Date().toISOString(),d={messageId:{S:a},username:{S:r},text:{S:s},createdAt:{S:i}};return await c.send(new y({TableName:process.env.TABLE_NAME||"ShuiMessages",Item:d})),l(201,{id:a,username:r,text:s,createdAt:i})}catch(t){return console.error("createMessage error",t),l(500,{error:"Internal error"})}},l=(e,t)=>({statusCode:e,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"http://localhost:5173","Access-Control-Allow-Credentials":"true"},body:JSON.stringify(t)});export{N as handler};
//# sourceMappingURL=index.js.map
