{
  "version": 3,
  "sources": ["../../../../functions/updateMessage/index.mjs", "../../../../services/db.mjs"],
  "sourcesContent": ["import { GetItemCommand, UpdateItemCommand } from \"@aws-sdk/client-dynamodb\";\nimport { client } from \"../../services/db.mjs\";\n// import { sendResponse } from \"../../utils/responses.mjs\";\n\nexport const handler = async (event) => {\n  try {\n    const id = event.pathParameters && event.pathParameters.id;\n    if (!id) return sendResponse(400, { error: \"Missing id\" });\n\n    const body = JSON.parse(event.body || \"{}\");\n    const { text } = body;\n    if (!text) return sendResponse(400, { error: \"text required\" });\n\n    const get = await client.send(\n      new GetItemCommand({\n        TableName: process.env.TABLE_NAME || \"ShuiMessages\",\n        Key: { messageId: { S: id } },\n      })\n    );\n    if (!get.Item) return sendResponse(404, { error: \"Message not found\" });\n\n    const now = new Date().toISOString();\n    await client.send(\n      new UpdateItemCommand({\n        TableName: process.env.TABLE_NAME || \"ShuiMessages\",\n        Key: { messageId: { S: id } },\n        UpdateExpression: \"SET #t = :text, updatedAt = :u\",\n        ExpressionAttributeNames: { \"#t\": \"text\" },\n        ExpressionAttributeValues: {\n          \":text\": { S: text },\n          \":u\": { S: now },\n        },\n      })\n    );\n\n    return sendResponse(200, {\n      id,\n      text,\n      username: get.Item.username.S,\n      createdAt: get.Item.createdAt.S,\n      updatedAt: now,\n    });\n  } catch (err) {\n    console.error(\"updateMessage error\", err);\n    return sendResponse(500, { error: \"Internal error\" });\n  }\n};\nconst sendResponse = (statusCode, body) => ({\n  statusCode,\n  headers: {\n    \"Content-Type\": \"application/json\",\n    \"Access-Control-Allow-Origin\": \"http://localhost:5173\",\n    \"Access-Control-Allow-Credentials\": \"true\",\n  },\n  body: JSON.stringify(body),\n});\n", "import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\nexport const client = new DynamoDBClient({ region: \"eu-north-1\" });\n"],
  "mappings": "AAAA,OAAS,kBAAAA,EAAgB,qBAAAC,MAAyB,2BCAlD,OAAS,kBAAAC,MAAsB,2BACxB,IAAMC,EAAS,IAAID,EAAe,CAAE,OAAQ,YAAa,CAAC,EDG1D,IAAME,EAAU,MAAOC,GAAU,CACtC,GAAI,CACF,IAAMC,EAAKD,EAAM,gBAAkBA,EAAM,eAAe,GACxD,GAAI,CAACC,EAAI,OAAOC,EAAa,IAAK,CAAE,MAAO,YAAa,CAAC,EAEzD,IAAMC,EAAO,KAAK,MAAMH,EAAM,MAAQ,IAAI,EACpC,CAAE,KAAAI,CAAK,EAAID,EACjB,GAAI,CAACC,EAAM,OAAOF,EAAa,IAAK,CAAE,MAAO,eAAgB,CAAC,EAE9D,IAAMG,EAAM,MAAMC,EAAO,KACvB,IAAIC,EAAe,CACjB,UAAW,QAAQ,IAAI,YAAc,eACrC,IAAK,CAAE,UAAW,CAAE,EAAGN,CAAG,CAAE,CAC9B,CAAC,CACH,EACA,GAAI,CAACI,EAAI,KAAM,OAAOH,EAAa,IAAK,CAAE,MAAO,mBAAoB,CAAC,EAEtE,IAAMM,EAAM,IAAI,KAAK,EAAE,YAAY,EACnC,aAAMF,EAAO,KACX,IAAIG,EAAkB,CACpB,UAAW,QAAQ,IAAI,YAAc,eACrC,IAAK,CAAE,UAAW,CAAE,EAAGR,CAAG,CAAE,EAC5B,iBAAkB,iCAClB,yBAA0B,CAAE,KAAM,MAAO,EACzC,0BAA2B,CACzB,QAAS,CAAE,EAAGG,CAAK,EACnB,KAAM,CAAE,EAAGI,CAAI,CACjB,CACF,CAAC,CACH,EAEON,EAAa,IAAK,CACvB,GAAAD,EACA,KAAAG,EACA,SAAUC,EAAI,KAAK,SAAS,EAC5B,UAAWA,EAAI,KAAK,UAAU,EAC9B,UAAWG,CACb,CAAC,CACH,OAASE,EAAK,CACZ,eAAQ,MAAM,sBAAuBA,CAAG,EACjCR,EAAa,IAAK,CAAE,MAAO,gBAAiB,CAAC,CACtD,CACF,EACMA,EAAe,CAACS,EAAYR,KAAU,CAC1C,WAAAQ,EACA,QAAS,CACP,eAAgB,mBAChB,8BAA+B,wBAC/B,mCAAoC,MACtC,EACA,KAAM,KAAK,UAAUR,CAAI,CAC3B",
  "names": ["GetItemCommand", "UpdateItemCommand", "DynamoDBClient", "client", "handler", "event", "id", "sendResponse", "body", "text", "get", "client", "GetItemCommand", "now", "UpdateItemCommand", "err", "statusCode"]
}
